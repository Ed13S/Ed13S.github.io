<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://i.ibb.co/TDWtHtCx/image.png" type="image/png">
    <title>EDDIE13S // SECURE</title>
</head>
<body>
    <canvas id="matrix-canvas"></canvas>

    <div id="custom-alert">
        <div class="alert-header">_SYSTEM_NOTIFICATION</div>
        <p id="alert-msg"></p>
        <button onclick="closeAlert()" id="alert-btn">ACKNOWLEDGE</button>
    </div>

    <div class="container">
        <div class="system-dashboard">
            <span>STATUS: <span style="color: #2ecc71;">ENCRYPTED</span></span>
            <span id="live-clock">00:00:00</span>
            <span id="user-ip">IP: FETCHING...</span>
        </div>

        <div class="custom-header reveal active">
            <div class="inner-header">
                <a href="index.html" class="home-link glitch" data-text="EDDIE13S">EDDIE13S</a>
                <div class="nav-links">
                    <a href="index.html">About</a>
                    <a href="feedback.html">Feedback</a>
                    <button id="theme-toggle">Mode</button>
                </div>
            </div>
        </div>

        <div class="custom-header reveal active">
            <p id="typing-text" style="margin:0; min-height: 1.2rem;"></p>
        </div>

        <input type="text" id="post-search" placeholder="Search all posts..." class="reveal active">

        <div id="admin-panel">
            <h3 style="margin-top:0;">_ADMIN_ACCESS</h3>
            <input type="text" id="new-title" placeholder="Post Title">
            <input type="text" id="new-link" placeholder="Link (URL)">
            <input type="text" id="new-category" placeholder="Category">
            <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="addPost()">Add Locally</button>
                <button onclick="downloadUpdatedFiles()" style="background: #2ecc71; color: white;">Export Core (index.html)</button>
                <button onclick="clearLocalStorage()" style="border-color: #e74c3c; color: #e74c3c;">Reset Local</button>
            </div>
        </div>

        <div id="posts-container">
            <div class="post-wrapper reveal active" data-date="January 11, 2023">
                <a href="https://github.com/Ed13S" class="post-card">
                    <div class="post-date">January 11, 2023</div>
                    <span class="post-title">Check out my profile at GitHub @Ed13S</span>
                    <div class="post-category">Information, Profiles</div>
                </a>
            </div>
        </div>
    </div>

    <button id="backToTop">â¬†</button>

    <script>
        // 1. MATRIX BACKGROUND
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()";
        const fontSize = 16;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(1);
        function drawMatrix() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.05)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
            ctx.font = fontSize + "px monospace";
            for (let i = 0; i < drops.length; i++) {
                const text = letters.charAt(Math.floor(Math.random() * letters.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 50);

        // 2. ACTUAL IP FETCH
        fetch('https://api.ipify.org?format=json')
            .then(res => res.json())
            .then(data => document.getElementById('user-ip').innerText = "IP: " + data.ip)
            .catch(() => document.getElementById('user-ip').innerText = "IP: HIDDEN");

        // 3. TERMINAL TYPER
        const bioText = "I am Eddie, 15 years old. Specializing in cyber security software and secure systems.";
        let charIdx = 0;
        function typeWriter() {
            if (charIdx < bioText.length) {
                document.getElementById("typing-text").innerHTML += bioText.charAt(charIdx);
                charIdx++; setTimeout(typeWriter, 50);
            }
        }

        // 4. ADMIN & SEARCH
        document.getElementById('post-search').oninput = (e) => {
            const val = e.target.value.toLowerCase();
            document.getElementById('admin-panel').style.display = (val === 'admin') ? 'block' : 'none';
            if (val === 'admin') document.documentElement.setAttribute('data-admin', 'true');
            
            document.querySelectorAll('.post-wrapper').forEach(p => {
                const title = p.querySelector('.post-title').innerText.toLowerCase();
                p.style.display = title.includes(val) || val === 'admin' ? 'block' : 'none';
            });
        };

        // 5. POST MANAGEMENT (FIXED)
        function addPost() {
            const title = document.getElementById('new-title').value;
            const link = document.getElementById('new-link').value;
            const cat = document.getElementById('new-category').value;
            if(!title || !link) return showAlert("Title and Link required");
            const post = { title, link, cat, date: new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) };
            const saved = JSON.parse(localStorage.getItem('my_custom_posts')) || [];
            saved.push(post);
            localStorage.setItem('my_custom_posts', JSON.stringify(saved));
            location.reload();
        }

        function downloadUpdatedFiles() {
            let content = document.documentElement.outerHTML;
            let parser = new DOMParser();
            let doc = parser.parseFromString(content, 'text/html');
            // Remove selection tools before saving
            doc.querySelectorAll('.admin-selector').forEach(el => el.remove());
            doc.querySelectorAll('.local-post').forEach(el => el.classList.remove('local-post'));
            
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/html;charset=utf-8,' + encodeURIComponent(doc.documentElement.outerHTML));
            element.setAttribute('download', "index.html");
            element.click();
        }

        function clearLocalStorage() {
            if(confirm("Wipe local data?")) { localStorage.removeItem('my_custom_posts'); location.reload(); }
        }

        // 6. ALERTS & THEME
        function showAlert(msg) {
            document.getElementById('alert-msg').innerText = "> " + msg;
            document.getElementById('custom-alert').style.display = 'block';
        }
        function closeAlert() { document.getElementById('custom-alert').style.display = 'none'; }
        
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme) document.documentElement.setAttribute('data-theme', currentTheme);
        document.getElementById('theme-toggle').onclick = () => {
            let theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        };

        window.onload = () => {
            typeWriter();
            const saved = JSON.parse(localStorage.getItem('my_custom_posts')) || [];
            saved.forEach((p, index) => {
                const html = `
                    <div class="post-wrapper local-post reveal active">
                        <div class="admin-selector"><input type="checkbox" class="post-checkbox" checked></div>
                        <a href="${p.link}" class="post-card">
                            <div class="post-date">${p.date}</div>
                            <span class="post-title">${p.title}</span>
                            <div class="post-category">${p.cat}</div>
                        </a>
                    </div>`;
                document.getElementById('posts-container').insertAdjacentHTML('afterbegin', html);
            });
            if (!localStorage.getItem('alerted')) {
                showAlert("AUTHORIZED ACCESS ONLY. SYSTEM MONITORING ACTIVE.");
                localStorage.setItem('alerted', 'true');
            }
        };
    </script>
</body>
</html>
